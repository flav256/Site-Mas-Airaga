// Translations
const translations = {
  fr: {
    "page-title": "Mas Airaga - Maison de charme à Eyragues",
    "nav-atouts": "Atouts",
    "nav-photos": "Photos",
    "nav-amenities": "Équipements",
    "nav-pricing": "Tarifs",
    "nav-location": "Localisation",
    "nav-book": "Réserver",
    "hero-eyebrow": "Villa avec piscine",
    "hero-title": "Très beau \"Mas Airaga\" au calme, à 4 km de St-Rémy",
    "hero-lead": "Mas entièrement climatisé, tout en lumière, 185 m2 habitables. Jardin parfumé à la lavande et aux oliviers d'environ 2000 m2 avec piscine sécurisée. DÉTENTE GARANTIE !",
    "cta-book": "Réserver en direct",
    "cta-discover": "Découvrir la maison",
    "meta-guests": "10 voyageurs",
    "meta-pool": "Piscine sécurisée",
    "meta-parking": "Parking privé",
    "meta-ac": "Climatisation",
    "atouts-eyebrow": "Pourquoi ici",
    "atouts-title": "Les atouts pour vos séjours",
    "atouts-subtitle": "Un mas provençal de 185 m2 tout en lumière, à proximité des commerces et à 4 km de Saint-Rémy-de-Provence.",
    "atout1-title": "Piscine sécurisée",
    "atout1-desc": "Jardin de 2000 m2 parfumé à la lavande et aux oliviers avec piscine privée et sécurisée pour une détente absolue.",
    "atout2-title": "Espace généreux",
    "atout2-desc": "185 m2 habitables entièrement climatisés avec 10 couchages, idéal pour familles et groupes d'amis.",
    "atout3-title": "Emplacement idéal",
    "atout3-desc": "À 4 km de Saint-Rémy-de-Provence, proche des Alpilles et des plus beaux villages de Provence.",
    "photos-eyebrow": "Visite virtuelle",
    "photos-title": "Découvrez chaque espace",
    "photos-subtitle": "Une visite guidée du Mas Airaga, pièce par pièce.",
    "space-outdoor-title": "Piscine et extérieurs",
    "space-outdoor-desc": "Jardin de 2000 m2 avec piscine privée sécurisée, lavande et oliviers. Parfait pour se détendre en plein air.",
    "space-living-title": "Salon et espaces de vie",
    "space-living-desc": "Salon lumineux et spacieux avec TV, climatisation et grandes fenêtres donnant sur le jardin.",
    "space-kitchen-title": "Cuisine et salle à manger",
    "space-kitchen-desc": "Cuisine entièrement équipée avec machine à café, lave-vaisselle et grande table à manger pour partager vos repas.",
    "space-bedrooms-title": "Chambres (4 chambres, 10 couchages)",
    "space-bedrooms-desc": "Chambres confortables avec literie de qualité.",
    "bedroom1-title": "Chambre 1 (RDC) - Salle de douche en suite",
    "bedroom1-desc": "Lit queen",
    "bedroom23-title": "Chambres 2 & 3 (Étage) - Salle de bain attenante",
    "bedroom23-desc": "Lits queen avec canapés-lits simples",
    "bedroom4-title": "Chambre 4 (Étage) - Master bedroom, salle de douche en suite",
    "bedroom4-desc": "Lit queen avec canapé-lit",
    "space-bathrooms-title": "Salles de bain (3 salles de bain complètes)",
    "space-bathrooms-desc": "Trois salles de bain modernes avec douche, WC et tous les équipements nécessaires.",
    "space-extras-title": "Équipements et loisirs",
    "space-extras-desc": "Table de ping-pong, barbecue, terrasse ombragée et tout le confort pour profiter de vos vacances.",
    "amenities-eyebrow": "Équipements",
    "amenities-title": "Ce qui est inclus",
    "amenity1": "Climatisation intégrale & chauffage",
    "amenity2": "Piscine privée sécurisée",
    "amenity3": "Jardin 2000 m2 (lavande, oliviers)",
    "amenity4": "Wi-Fi haut débit",
    "amenity5": "10 couchages (4 chambres)",
    "amenity6": "Cuisine entièrement équipée",
    "amenity7": "Lave-linge et sèche-linge",
    "amenity8": "Terrasse avec mobilier de jardin",
    "amenity9": "Parking privé",
    "amenity10": "Linge de maison fourni",
    "amenity11": "À 4 km de Saint-Rémy-de-Provence",
    "amenity12": "Proche commerces et restaurants",
    "location-eyebrow": "Autour de vous",
    "location-title": "Localisation",
    "location-subtitle": "Eyragues, Bouches-du-Rhône. Idéalement situé à proximité des commerces, à 4 km de Saint-Rémy-de-Provence et au cœur de la Provence.",
    "access-title": "Temps d'accès",
    "access-times": "Saint-Rémy : 4 km · Avignon : 15 min · Arles : 30 min · Aéroport Marseille : 1h",
    "booking-eyebrow": "Réservation",
    "booking-title": "Réservez en direct ou sur Airbnb",
    "booking-subtitle": "Profitez du meilleur prix en direct. Indiquez vos dates, nous répondons rapidement.",
    "form-name": "Prénom et nom",
    "form-email": "Email",
    "form-phone": "Téléphone",
    "form-adults": "Adultes",
    "form-children": "Enfants",
    "form-checkin": "Arrivée",
    "form-checkout": "Départ",
    "form-message": "Message",
    "form-submit": "Demander une disponibilité",
    "booking-nights": "Nuits",
    "booking-rate": "Hébergement",
    "booking-tax": "Taxe de séjour",
    "booking-total": "Total estimé",
    "badge-quick": "Réponse rapide",
    "aside-title": "Tarif direct avantageux",
    "aside-desc": "Contact direct propriétaire. Caution et contrat simple. Paiement sécurisé.",
    "benefits-title": "Avantages de la réservation directe",
    "benefit-1": "Aucun frais Airbnb / Abritel / Booking",
    "benefit-2": "Contact direct avec les propriétaires",
    "benefit-3": "Contrat de location fourni",
    "benefit-4": "Offres spéciales et réductions pour séjours longue durée",
    "btn-email": "Écrire un email",
    "btn-airbnb": "Voir sur Airbnb",
    "contact-owners": "Virginie et Flavien",
    "footer-registration": "Maison meublée déclarée • Eyragues, Provence",
    "footer-contact": "Contact :",
    "reviews-eyebrow": "Avis clients",
    "reviews-title": "Ce que nos voyageurs en pensent",
    "reviews-count": "44 avis",
    "review1-date": "Août 2025",
    "review1-text": "L'emplacement est calme, et la maison confortable. Il y a vraiment de tout, nous nous sommes sentis comme chez nous ! L'hôte est très réactive et ça fait vraiment la différence.",
    "review2-date": "Juillet 2025",
    "review2-text": "Maison incroyable et spacieuse, très confortable et bien équipée. Super jardin et piscine. Très propre et dans un bon emplacement.",
    "review3-date": "Août 2025",
    "review3-text": "Magnifique maison pour une grande famille ! Superbe cour et piscine. Maison bien équipée et exactement comme sur les photos. Communication parfaite !",
    "review4-date": "Août 2024",
    "review4-text": "Un séjour incroyable ! Maison très spacieuse, nombreuses commodités et piscine géniale. Virginie a été super réactive. Je recommande fortement !",
    "review5-date": "Juillet 2023",
    "review5-text": "Maison magnifique, propre et très bien entretenue dans un endroit calme et reposant. Un excellent séjour !",
    "review6-date": "Août 2023",
    "review6-text": "Superbe maison avec piscine. Tous les équipements étaient là. Belle chambre spacieuse et moderne. Parfaite pour les familles !",
    "reviews-see-all": "Voir les 44 avis sur Airbnb",
    "pricing-eyebrow": "Tarifs",
    "pricing-title": "Tarifs & Conditions",
    "pricing-subtitle": "Tarifs transparents pour votre séjour au Mas Airaga",
    "pricing-standard-title": "Tarif Standard",
    "pricing-standard-period": "17 avril au 3 juillet & 29 août au 3 octobre",
    "pricing-standard-rate": "500€ / nuit",
    "pricing-standard-min": "Minimum 4 nuits",
    "pricing-standard-degressive": "Tarif dégressif",
    "pricing-standard-5nights": "5 nuits : 2 400€",
    "pricing-standard-6nights": "6 nuits : 2 700€",
    "pricing-standard-7nights": "7 nuits : 2 900€",
    "pricing-standard-15nights": "15 nuits : 5 000€",
    "pricing-high-title": "Haute Saison",
    "pricing-high-period": "4 juillet au 28 août",
    "pricing-high-rate": "3 900€ / semaine",
    "pricing-high-constraint": "Arrivée/départ : samedi uniquement",
    "pricing-included": "Ménage et linge de maison inclus",
    "pricing-deposit": "Caution : 1 500€",
    "pricing-tax": "Tarif hors Taxe de séjour",
    "pricing-closed": "Fermé avant le 17 avril et après le 3 octobre 2026",
    "faq-eyebrow": "Questions fréquentes",
    "faq-title": "Informations pratiques",
    "faq-checkin-q": "Horaires d'arrivée et de départ",
    "faq-checkin-a": "Arrivée : 17h - 23h · Départ : 8h - 10h",
    "faq-pets-q": "Animaux acceptés ?",
    "faq-pets-a": "Oui, avec supplément de 200€",
    "faq-smoking-q": "Peut-on fumer ?",
    "faq-smoking-a": "Interdit à l'intérieur, autorisé en extérieur",
    "calculator-title": "Calculateur de prix",
    "calculator-subtitle": "Estimez le coût de votre séjour",
    "calculator-checkin": "Date d'arrivée",
    "calculator-checkout": "Date de départ",
    "calculator-adults": "Adultes (18 ans et +)",
    "calculator-children": "Enfants (- de 18 ans)",
    "calculator-nights": "Nombre de nuits",
    "calculator-guests": "Voyageurs",
    "calculator-rate": "Tarif hébergement",
    "calculator-tourism-tax": "Taxe de séjour",
    "calculator-total": "Total TTC",
    "calculator-send-email": "Envoyer une demande de réservation",
    "around-eyebrow": "Les Alentours",
    "around-title": "Découvrez les Alpilles",
    "around-subtitle": "Sites naturels, villages perchés et patrimoine provençal à explorer autour du Mas Airaga",
    "around-nature-title": "Nature & Paysages",
    "around-nature-desc": "Randonnées dans les Alpilles, champs de lavande, oliveraies centenaires",
    "around-villages-title": "Villages & Patrimoine",
    "around-villages-desc": "Les Baux-de-Provence, Saint-Rémy, Arles, Avignon et leurs marchés provençaux",
    "around-culture-title": "Culture & Art de vivre",
    "around-culture-desc": "Caves viticoles, moulins à huile, antiquités et gastronomie locale",
    "around-activity1": "Saint-Rémy-de-Provence",
    "around-activity1-desc": "Village provençal authentique avec son célèbre marché, à 4 km",
    "around-activity2": "Les Baux-de-Provence",
    "around-activity2-desc": "Village médiéval perché classé parmi les plus beaux villages de France",
    "around-activity3": "Alpilles",
    "around-activity3-desc": "Parc naturel régional avec sentiers de randonnée et panoramas",
    "around-activity4": "Avignon",
    "around-activity4-desc": "Palais des Papes et festival de théâtre, à 15 minutes",
    "around-activity5": "Arles",
    "around-activity5-desc": "Arènes romaines et patrimoine Van Gogh, à 30 minutes",
    "around-activity6": "Vignobles",
    "around-activity6-desc": "Route des vins des Alpilles et dégustations dans les domaines"
  },
  en: {
    "page-title": "Mas Airaga - Charming House in Eyragues",
    "nav-atouts": "Features",
    "nav-photos": "Photos",
    "nav-amenities": "Amenities",
    "nav-pricing": "Pricing",
    "nav-location": "Location",
    "nav-book": "Book",
    "hero-eyebrow": "Villa with pool",
    "hero-title": "Very nice \"Mas Airaga\" in a quiet location, 4 km from St-Rémy",
    "hero-lead": "Fully air-conditioned farmhouse, full of light, 185 m2 of living space. Garden scented with lavender and olive trees on approximately 2000 m2 with secure swimming pool. RELAXATION GUARANTEED!",
    "cta-book": "Book direct",
    "cta-discover": "Discover the house",
    "meta-guests": "10 guests",
    "meta-pool": "Secure pool",
    "meta-parking": "Private parking",
    "meta-ac": "Air conditioning",
    "atouts-eyebrow": "Why here",
    "atouts-title": "Features for your stay",
    "atouts-subtitle": "A 185 m2 Provençal farmhouse full of light, close to shops and 4 km from Saint-Rémy-de-Provence.",
    "atout1-title": "Secure swimming pool",
    "atout1-desc": "2000 m2 garden scented with lavender and olive trees with private secure swimming pool for absolute relaxation.",
    "atout2-title": "Generous space",
    "atout2-desc": "185 m2 of fully air-conditioned living space with 10 beds, ideal for families and groups of friends.",
    "atout3-title": "Ideal location",
    "atout3-desc": "4 km from Saint-Rémy-de-Provence, close to the Alpilles and the most beautiful villages of Provence.",
    "photos-eyebrow": "Virtual tour",
    "photos-title": "Discover each space",
    "photos-subtitle": "A guided tour of Mas Airaga, room by room.",
    "space-outdoor-title": "Pool and outdoor areas",
    "space-outdoor-desc": "2000 m2 garden with private secure pool, lavender and olive trees. Perfect for relaxing outdoors.",
    "space-living-title": "Living room and common areas",
    "space-living-desc": "Bright and spacious living room with TV, air conditioning and large windows overlooking the garden.",
    "space-kitchen-title": "Kitchen and dining room",
    "space-kitchen-desc": "Fully equipped kitchen with coffee machine, dishwasher and large dining table for sharing your meals.",
    "space-bedrooms-title": "Bedrooms (4 bedrooms, 10 beds)",
    "space-bedrooms-desc": "Comfortable bedrooms with quality bedding.",
    "bedroom1-title": "Bedroom 1 (Ground floor) - Ensuite shower room",
    "bedroom1-desc": "Queen bed",
    "bedroom23-title": "Bedrooms 2 & 3 (Upstairs) - Adjacent bathroom",
    "bedroom23-desc": "Queen beds with single sofa beds",
    "bedroom4-title": "Bedroom 4 (Upstairs) - Master bedroom, ensuite shower room",
    "bedroom4-desc": "Queen bed with sofa bed",
    "space-bathrooms-title": "Bathrooms (3 full bathrooms)",
    "space-bathrooms-desc": "Three modern bathrooms with shower, toilet and all necessary amenities.",
    "space-extras-title": "Amenities and leisure",
    "space-extras-desc": "Ping-pong table, barbecue, shaded terrace and all the comfort to enjoy your vacation.",
    "amenities-eyebrow": "Amenities",
    "amenities-title": "What's included",
    "amenity1": "Full air conditioning & heating",
    "amenity2": "Private secure swimming pool",
    "amenity3": "2000 m2 garden (lavender, olive trees)",
    "amenity4": "High-speed Wi-Fi",
    "amenity5": "10 beds (4 bedrooms)",
    "amenity6": "Fully equipped kitchen",
    "amenity7": "Washer and dryer",
    "amenity8": "Terrace with garden furniture",
    "amenity9": "Private parking",
    "amenity10": "Bed linen provided",
    "amenity11": "4 km from Saint-Rémy-de-Provence",
    "amenity12": "Close to shops and restaurants",
    "location-eyebrow": "Around you",
    "location-title": "Location",
    "location-subtitle": "Eyragues, Bouches-du-Rhône. Ideally located close to shops, 4 km from Saint-Rémy-de-Provence and in the heart of Provence.",
    "access-title": "Access times",
    "access-times": "Saint-Rémy: 4 km · Avignon: 15 min · Arles: 30 min · Marseille Airport: 1h",
    "booking-eyebrow": "Booking",
    "booking-title": "Book direct or on Airbnb",
    "booking-subtitle": "Enjoy the best price by booking direct. Tell us your dates, we'll respond quickly.",
    "form-name": "First and last name",
    "form-email": "Email",
    "form-phone": "Phone",
    "form-adults": "Adults",
    "form-children": "Children",
    "form-checkin": "Check-in",
    "form-checkout": "Check-out",
    "form-message": "Message",
    "form-submit": "Request availability",
    "booking-nights": "Nights",
    "booking-rate": "Accommodation",
    "booking-tax": "Tourist tax",
    "booking-total": "Estimated total",
    "badge-quick": "Quick response",
    "aside-title": "Advantageous direct rate",
    "aside-desc": "Direct contact with owner. Simple deposit and contract. Secure payment.",
    "benefits-title": "Benefits of booking direct",
    "benefit-1": "No Airbnb / Abritel / Booking fees",
    "benefit-2": "Direct contact with the owners",
    "benefit-3": "Rental contract provided",
    "benefit-4": "Special offers and discounts for long stays",
    "btn-email": "Send an email",
    "btn-airbnb": "View on Airbnb",
    "contact-owners": "Virginie and Flavien",
    "footer-registration": "Registered furnished accommodation • Eyragues, Provence",
    "footer-contact": "Contact:",
    "around-eyebrow": "Surroundings",
    "around-title": "Discover the Alpilles",
    "around-subtitle": "Natural sites, hilltop villages and Provencal heritage to explore around Mas Airaga",
    "around-nature-title": "Nature & Landscapes",
    "around-nature-desc": "Hiking in the Alpilles, lavender fields, century-old olive groves",
    "around-villages-title": "Villages & Heritage",
    "around-villages-desc": "Perched villages, Provencal markets, historical monuments",
    "around-culture-title": "Culture & Lifestyle",
    "around-culture-desc": "Wine estates, local crafts, Provencal gastronomy",
    "around-saintrem-title": "Saint-Rémy-de-Provence",
    "around-saintrem-desc": "Picturesque town with Provencal market, Van Gogh trail and authentic charm",
    "around-saintrem-distance": "4 km",
    "around-lesbaux-title": "Les Baux-de-Provence",
    "around-lesbaux-desc": "Medieval village perched on a rocky outcrop with breathtaking views",
    "around-lesbaux-distance": "12 km",
    "around-alpilles-title": "Alpilles Regional Park",
    "around-alpilles-desc": "Hiking trails, cycling, exceptional flora and fauna",
    "around-alpilles-distance": "In the heart",
    "around-avignon-title": "Avignon",
    "around-avignon-desc": "Papal City, Palais des Papes, Pont d'Avignon, summer festival",
    "around-avignon-distance": "25 km",
    "around-arles-title": "Arles",
    "around-arles-desc": "Roman arenas, Van Gogh heritage, Camargue gateway",
    "around-arles-distance": "30 km",
    "around-vineyards-title": "Vineyards",
    "around-vineyards-desc": "Wine estates, wine tastings, Châteauneuf-du-Pape and Provence wines",
    "around-vineyards-distance": "5-20 km",
    "reviews-eyebrow": "Guest reviews",
    "reviews-title": "What our guests think",
    "reviews-count": "44 reviews",
    "review1-date": "August 2025",
    "review1-text": "The location is quiet, and the house is comfortable. There's really everything, we felt at home! The host is very responsive and it really makes a difference.",
    "review2-date": "July 2025",
    "review2-text": "Amazing and spacious house, very comfortable and well equipped. Great garden and pool. Very clean and in a good location.",
    "review3-date": "August 2025",
    "review3-text": "Beautiful house for a large family! Superb yard and pool. House well equipped and exactly as in the photos. Perfect communication!",
    "review4-date": "August 2024",
    "review4-text": "An incredible stay! Very spacious house, numerous amenities and great pool. Virginie was super responsive. I highly recommend!",
    "review5-date": "July 2023",
    "review5-text": "Beautiful house, clean and very well maintained in a quiet and relaxing place. An excellent stay!",
    "review6-date": "August 2023",
    "review6-text": "Superb house with pool. All the equipment was there. Beautiful spacious and modern room. Perfect for families!",
    "reviews-see-all": "See all 44 reviews on Airbnb",
    "pricing-eyebrow": "Pricing",
    "pricing-title": "Rates & Conditions",
    "pricing-subtitle": "Transparent pricing for your stay at Mas Airaga",
    "pricing-standard-title": "Standard Rate",
    "pricing-standard-period": "April 17 to July 3 & August 29 to October 3",
    "pricing-standard-rate": "€500 / night",
    "pricing-standard-min": "Minimum 4 nights",
    "pricing-standard-degressive": "Degressive rate",
    "pricing-standard-5nights": "5 nights: €2,400",
    "pricing-standard-6nights": "6 nights: €2,700",
    "pricing-standard-7nights": "7 nights: €2,900",
    "pricing-standard-15nights": "15 nights: €5,000",
    "pricing-high-title": "High Season",
    "pricing-high-period": "July 4 to August 28",
    "pricing-high-rate": "€3,900 / week",
    "pricing-high-constraint": "Check-in/out: Saturday only",
    "pricing-included": "Cleaning and linens included",
    "pricing-deposit": "Deposit: €1,500",
    "pricing-tax": "Price excluding tourist tax",
    "pricing-closed": "Closed before April 17 and after October 3, 2026",
    "faq-eyebrow": "FAQ",
    "faq-title": "Practical Information",
    "faq-checkin-q": "Check-in and check-out times",
    "faq-checkin-a": "Check-in: 5pm - 11pm · Check-out: 8am - 10am",
    "faq-pets-q": "Pets allowed?",
    "faq-pets-a": "Yes, with €200 surcharge",
    "faq-smoking-q": "Smoking allowed?",
    "faq-smoking-a": "Forbidden indoors, allowed outdoors",
    "calculator-title": "Price Calculator",
    "calculator-subtitle": "Estimate the cost of your stay",
    "calculator-checkin": "Check-in date",
    "calculator-checkout": "Check-out date",
    "calculator-adults": "Adults (18 years and over)",
    "calculator-children": "Children (under 18)",
    "calculator-nights": "Number of nights",
    "calculator-guests": "Guests",
    "calculator-rate": "Accommodation rate",
    "calculator-tourism-tax": "Tourist tax",
    "calculator-total": "Total incl. tax",
    "calculator-send-email": "Send booking request"
  }
};

// Language switcher
let currentLang = 'fr';

function setLanguage(lang) {
  currentLang = lang;
  document.documentElement.lang = lang;

  // Update all elements with data-i18n attribute
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.getAttribute('data-i18n');
    if (translations[lang] && translations[lang][key]) {
      element.textContent = translations[lang][key];
    }
  });

  // Update active button
  document.querySelectorAll('.nav-lang-btn').forEach(btn => {
    btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
  });

  // Save preference
  localStorage.setItem('preferred-language', lang);
}

// Language button listeners
document.querySelectorAll('.nav-lang-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    setLanguage(btn.getAttribute('data-lang'));
  });
});

// Load saved language preference or detect browser language
const savedLang = localStorage.getItem('preferred-language');
const browserLang = navigator.language.startsWith('fr') ? 'fr' : 'en';
const initialLang = savedLang || browserLang;
setLanguage(initialLang);

// Booking form with intelligent calendar and automatic price calculation
const bookingForm = document.getElementById("bookingForm");
const bookingCheckinInput = document.getElementById("booking-checkin");
const bookingCheckoutInput = document.getElementById("booking-checkout");
const bookingAdultsInput = document.getElementById("booking-adults");
const bookingChildrenInput = document.getElementById("booking-children");
const bookingPriceSummary = document.getElementById("booking-price-summary");
const bookingNightsValue = document.getElementById("booking-nights-value");
const bookingRateValue = document.getElementById("booking-rate-value");
const bookingTaxValue = document.getElementById("booking-tax-value");
const bookingTotalValue = document.getElementById("booking-total-value");
const bookingErrorsDiv = document.getElementById("booking-errors");

let bookingCalculatedData = null;

// Set default value to first available date (April 17, 2026)
if (bookingCheckinInput) {
  bookingCheckinInput.value = '2026-04-17';
}

// Helper function to get next Saturday
function getNextSaturday(date) {
  const result = new Date(date);
  result.setDate(result.getDate() + ((6 - result.getDay() + 7) % 7));
  return result;
}

// Helper function to format date as YYYY-MM-DD
function formatDateInput(date) {
  return date.toISOString().split('T')[0];
}

// Helper function to get all Saturdays in high season
function getHighSeasonSaturdays() {
  const saturdays = [];
  const start = new Date('2026-07-04');
  const end = new Date('2026-08-29');

  let current = getNextSaturday(new Date('2026-07-03'));
  while (current <= end) {
    saturdays.push(formatDateInput(current));
    current.setDate(current.getDate() + 7);
  }

  return saturdays;
}

// Calculate booking price
function calculateBookingPrice() {
  if (!bookingCheckinInput.value || !bookingCheckoutInput.value) {
    bookingPriceSummary.style.display = 'none';
    bookingCalculatedData = null;
    return;
  }

  const checkin = new Date(bookingCheckinInput.value);
  const checkout = new Date(bookingCheckoutInput.value);
  const adults = parseInt(bookingAdultsInput.value) || 0;
  const children = parseInt(bookingChildrenInput.value) || 0;
  const totalGuests = adults + children;
  const errors = [];

  const nights = Math.round((checkout - checkin) / (1000 * 60 * 60 * 24));

  if (nights <= 0) {
    bookingPriceSummary.style.display = 'none';
    bookingCalculatedData = null;
    return;
  }

  if (totalGuests > 10) {
    errors.push(currentLang === 'fr'
      ? 'Maximum 10 voyageurs.'
      : 'Maximum 10 guests.');
  }

  const seasonStart = new Date('2026-04-17');
  const highSeasonStart = new Date('2026-07-04');
  const highSeasonEnd = new Date('2026-08-28');
  const standardSeasonEnd = new Date('2026-10-03');

  if (checkin < seasonStart || checkout > standardSeasonEnd) {
    errors.push(currentLang === 'fr'
      ? 'Fermé avant le 17 avril et après le 3 octobre 2026.'
      : 'Closed before April 17 and after October 3, 2026.');
  }

  const isHighSeason = checkin >= highSeasonStart && checkout <= highSeasonEnd;
  const isMixedSeason = checkin < highSeasonStart && checkout > highSeasonStart;

  let price = 0;

  if (isHighSeason) {
    // Fully in high season
    const checkinDay = checkin.getDay();
    const checkoutDay = checkout.getDay();

    if (checkinDay !== 6 || checkoutDay !== 6) {
      errors.push(currentLang === 'fr'
        ? 'En haute saison, les arrivées et départs doivent être le samedi.'
        : 'During high season, check-in and check-out must be on Saturday.');
    }

    if (nights % 7 !== 0) {
      errors.push(currentLang === 'fr'
        ? 'En haute saison, les séjours doivent être par semaine complète (7, 14, 21 nuits...).'
        : 'During high season, stays must be full weeks (7, 14, 21 nights...).');
    }

    const weeks = Math.floor(nights / 7);
    price = weeks * 3900;

  } else if (isMixedSeason) {
    // Mixed season: starts in standard, extends into high season
    const checkoutDay = checkout.getDay();

    // Check if checkout is in July/August (high season period)
    const isCheckoutInHighSeason = checkout >= highSeasonStart && checkout <= highSeasonEnd;

    if (isCheckoutInHighSeason && checkoutDay !== 6) {
      errors.push(currentLang === 'fr'
        ? 'Départ en juillet/août uniquement possible le samedi.'
        : 'Check-out in July/August only allowed on Saturday.');
    }

    // Calculate split pricing
    // Standard season nights: from checkin to July 4
    const standardNights = Math.round((highSeasonStart - checkin) / (1000 * 60 * 60 * 24));

    // High season nights: from July 4 to checkout
    const highSeasonNights = Math.round((checkout - highSeasonStart) / (1000 * 60 * 60 * 24));

    // Calculate standard season portion
    let standardPrice = 0;
    if (standardNights >= 15) {
      standardPrice = 5000 + ((standardNights - 15) * 333);
    } else if (standardNights === 7) {
      standardPrice = 2900;
    } else if (standardNights === 6) {
      standardPrice = 2700;
    } else if (standardNights === 5) {
      standardPrice = 2400;
    } else {
      standardPrice = standardNights * 500;
    }

    // Calculate high season portion (7-day blocks at 3900€/week)
    const highSeasonWeeks = Math.floor(highSeasonNights / 7);
    const highSeasonPrice = highSeasonWeeks * 3900;

    // Remaining nights in high season (less than a week) - not allowed if checkout is in high season
    const remainingHighSeasonNights = highSeasonNights % 7;
    if (remainingHighSeasonNights > 0 && isCheckoutInHighSeason) {
      errors.push(currentLang === 'fr'
        ? 'En juillet/août, les séjours doivent être par semaine complète (7 jours).'
        : 'In July/August, stays must be full weeks (7 days).');
    }

    price = standardPrice + highSeasonPrice;

  } else {
    // Fully in standard season
    if (nights < 4) {
      errors.push(currentLang === 'fr'
        ? 'Minimum 4 nuits en période normale.'
        : 'Minimum 4 nights during standard period.');
    }

    if (nights >= 15) {
      price = 5000 + ((nights - 15) * 333);
    } else if (nights === 7) {
      price = 2900;
    } else if (nights === 6) {
      price = 2700;
    } else if (nights === 5) {
      price = 2400;
    } else {
      price = nights * 500;
    }
  }

  const taxPerAdultPerNight = 0.90;
  const touristTax = adults * nights * taxPerAdultPerNight;
  const totalPrice = price + touristTax;

  bookingCalculatedData = {
    checkin: bookingCheckinInput.value,
    checkout: bookingCheckoutInput.value,
    nights,
    adults,
    children,
    price,
    touristTax,
    totalPrice
  };

  bookingNightsValue.textContent = nights;
  bookingRateValue.textContent = `${price.toLocaleString('fr-FR')}€`;
  bookingTaxValue.textContent = `${touristTax.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}€`;
  bookingTotalValue.textContent = `${totalPrice.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}€`;

  if (errors.length > 0) {
    bookingErrorsDiv.innerHTML = errors.join('<br>');
  } else {
    bookingErrorsDiv.textContent = '';
  }

  bookingPriceSummary.style.display = 'block';
}

// Intelligent calendar constraints
if (bookingCheckinInput) {
  bookingCheckinInput.addEventListener('change', () => {
    const checkinDate = new Date(bookingCheckinInput.value);
    const highSeasonStart = new Date('2026-07-04');
    const highSeasonEnd = new Date('2026-08-28');

    // Check if in high season
    const isHighSeason = checkinDate >= highSeasonStart && checkinDate <= highSeasonEnd;

    if (isHighSeason) {
      // High season: only Saturdays
      const checkinDay = checkinDate.getDay();
      if (checkinDay !== 6) {
        // Find next Saturday
        const nextSat = getNextSaturday(checkinDate);
        bookingCheckinInput.value = formatDateInput(nextSat);
      }

      // Set checkout to 7 days later (next Saturday)
      const checkoutDate = new Date(bookingCheckinInput.value);
      checkoutDate.setDate(checkoutDate.getDate() + 7);
      bookingCheckoutInput.value = formatDateInput(checkoutDate);
      bookingCheckoutInput.min = formatDateInput(checkoutDate);

    } else {
      // Standard season: minimum 4 nights
      const minCheckout = new Date(checkinDate);
      minCheckout.setDate(minCheckout.getDate() + 4);
      bookingCheckoutInput.min = formatDateInput(minCheckout);
      bookingCheckoutInput.value = formatDateInput(minCheckout);
    }

    calculateBookingPrice();
  });
}

if (bookingCheckoutInput) {
  bookingCheckoutInput.addEventListener('change', () => {
    const checkinDate = new Date(bookingCheckinInput.value);
    const checkoutDate = new Date(bookingCheckoutInput.value);
    const highSeasonStart = new Date('2026-07-04');
    const highSeasonEnd = new Date('2026-08-28');

    // Check if checkout is in high season but checkin is not (mixed season)
    const isMixedSeason = checkinDate < highSeasonStart && checkoutDate > highSeasonStart;
    const isCheckoutInHighSeason = checkoutDate >= highSeasonStart && checkoutDate <= highSeasonEnd;

    if (isMixedSeason && isCheckoutInHighSeason) {
      // If checkout is in July/August, it must be a Saturday
      const checkoutDay = checkoutDate.getDay();
      if (checkoutDay !== 6) {
        // Find next Saturday
        const nextSat = getNextSaturday(checkoutDate);
        bookingCheckoutInput.value = formatDateInput(nextSat);
      }
    }

    calculateBookingPrice();
  });
}

if (bookingAdultsInput) {
  bookingAdultsInput.addEventListener('change', () => {
    const adults = parseInt(bookingAdultsInput.value) || 0;
    const children = parseInt(bookingChildrenInput.value) || 0;
    if (adults + children > 10) {
      bookingAdultsInput.value = 10 - children;
    }
    calculateBookingPrice();
  });
}

if (bookingChildrenInput) {
  bookingChildrenInput.addEventListener('change', () => {
    const adults = parseInt(bookingAdultsInput.value) || 0;
    const children = parseInt(bookingChildrenInput.value) || 0;
    if (adults + children > 10) {
      bookingChildrenInput.value = 10 - adults;
    }
    calculateBookingPrice();
  });
}

// Initial calculation
calculateBookingPrice();

if (bookingForm) {
  bookingForm.addEventListener("submit", (event) => {
    event.preventDefault();

    if (!bookingCalculatedData) {
      alert(currentLang === 'fr'
        ? 'Veuillez sélectionner des dates valides.'
        : 'Please select valid dates.');
      return;
    }

    const formData = new FormData(bookingForm);
    const name = formData.get("name");
    const email = formData.get("email");
    const phone = formData.get("phone") || "";
    const message = formData.get("message") || "";

    const contactEmail = "mas.airaga.contact@gmail.com";
    const subject = encodeURIComponent(
      currentLang === 'fr'
        ? "Demande de réservation - Mas Airaga"
        : "Booking request - Mas Airaga"
    );

    const phoneText = phone ? `\n${currentLang === 'fr' ? 'Téléphone' : 'Phone'} : ${phone}` : '';

    const body = encodeURIComponent(
      currentLang === 'fr'
        ? `Bonjour,\n\nJe souhaite réserver le Mas Airaga avec les informations suivantes :\n\nNom : ${name}\nEmail : ${email}${phoneText}\n\nArrivée : ${bookingCalculatedData.checkin}\nDépart : ${bookingCalculatedData.checkout}\nNombre de nuits : ${bookingCalculatedData.nights}\n\nVoyageurs :\n- Adultes : ${bookingCalculatedData.adults}\n- Enfants : ${bookingCalculatedData.children}\n\nEstimation du prix :\n- Tarif hébergement : ${bookingCalculatedData.price.toLocaleString('fr-FR')}€\n- Taxe de séjour : ${bookingCalculatedData.touristTax.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}€\n- Total TTC : ${bookingCalculatedData.totalPrice.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}€\n\nMessage : ${message}\n\nCordialement`
        : `Hello,\n\nI would like to book Mas Airaga with the following information:\n\nName: ${name}\nEmail: ${email}${phoneText}\n\nCheck-in: ${bookingCalculatedData.checkin}\nCheck-out: ${bookingCalculatedData.checkout}\nNumber of nights: ${bookingCalculatedData.nights}\n\nGuests:\n- Adults: ${bookingCalculatedData.adults}\n- Children: ${bookingCalculatedData.children}\n\nPrice estimate:\n- Accommodation rate: €${bookingCalculatedData.price.toLocaleString('fr-FR')}\n- Tourist tax: €${bookingCalculatedData.touristTax.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n- Total incl. tax: €${bookingCalculatedData.totalPrice.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n\nMessage: ${message}\n\nBest regards`
    );

    window.location.href = `mailto:${contactEmail}?subject=${subject}&body=${body}`;
  });
}

// Hero slider
const slides = document.querySelectorAll('.hero__slide');
let currentSlide = 0;

function nextSlide() {
  slides[currentSlide].classList.remove('active');
  currentSlide = (currentSlide + 1) % slides.length;
  slides[currentSlide].classList.add('active');
}

if (slides.length > 0) {
  setInterval(nextSlide, 5000); // Change slide every 5 seconds
}

// Scroll arrow
const scrollArrow = document.querySelector('.hero__scroll-arrow');
if (scrollArrow) {
  scrollArrow.addEventListener('click', () => {
    const firstSection = document.querySelector('#atouts');
    if (firstSection) {
      firstSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  });
}

// Sticky header shrink on scroll
const nav = document.querySelector('.nav');
let lastScroll = 0;

window.addEventListener('scroll', () => {
  const currentScroll = window.pageYOffset;

  if (currentScroll > 100) {
    nav.classList.add('scrolled');
  } else {
    nav.classList.remove('scrolled');
  }

  lastScroll = currentScroll;
});

// Scroll animations (fade-in, slide-up)
const observerOptions = {
  threshold: 0.1,
  rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      entry.target.classList.add('visible');
      observer.unobserve(entry.target); // Only animate once
    }
  });
}, observerOptions);

// Observe all sections
document.querySelectorAll('.section').forEach(section => {
  section.classList.add('fade-in');
  observer.observe(section);
});

// Observe cards with slide-up animation
document.querySelectorAll('.atout-card, .pricing-card, .faq-item, .around-category, .around-card, .review-card').forEach((card, index) => {
  card.classList.add('slide-up');

  // Add stagger effect for cards in the same container
  const staggerClass = `stagger-${(index % 4) + 1}`;
  card.classList.add(staggerClass);

  observer.observe(card);
});

// Price Calculator
const checkinInput = document.getElementById('calc-checkin');
const checkoutInput = document.getElementById('calc-checkout');
const adultsInput = document.getElementById('calc-adults');
const childrenInput = document.getElementById('calc-children');
const resultDiv = document.getElementById('calculator-result');
const nightsSpan = document.getElementById('calc-nights');
const guestsSpan = document.getElementById('calc-guests');
const rateSpan = document.getElementById('calc-rate');
const taxSpan = document.getElementById('calc-tax');
const totalSpan = document.getElementById('calc-total');
const errorsDiv = document.getElementById('calc-errors');
const sendEmailBtn = document.getElementById('calc-send-email');

let calculatedData = null;

function calculatePrice() {
  if (!checkinInput.value || !checkoutInput.value) {
    resultDiv.style.display = 'none';
    sendEmailBtn.style.display = 'none';
    return;
  }

  const checkin = new Date(checkinInput.value);
  const checkout = new Date(checkoutInput.value);
  const adults = parseInt(adultsInput.value) || 0;
  const children = parseInt(childrenInput.value) || 0;
  const totalGuests = adults + children;
  const errors = [];

  // Calculate number of nights
  const nights = Math.round((checkout - checkin) / (1000 * 60 * 60 * 24));

  if (nights <= 0) {
    errorsDiv.textContent = currentLang === 'fr'
      ? 'La date de départ doit être après la date d\'arrivée.'
      : 'Check-out date must be after check-in date.';
    resultDiv.style.display = 'block';
    nightsSpan.textContent = '-';
    guestsSpan.textContent = '-';
    rateSpan.textContent = '-';
    taxSpan.textContent = '-';
    totalSpan.textContent = '-';
    sendEmailBtn.style.display = 'none';
    return;
  }

  if (totalGuests > 10) {
    errors.push(currentLang === 'fr'
      ? 'Maximum 10 voyageurs.'
      : 'Maximum 10 guests.');
  }

  // Define season dates for 2026
  const seasonStart = new Date('2026-04-17');
  const highSeasonStart = new Date('2026-07-04');
  const highSeasonEnd = new Date('2026-08-28');
  const standardSeasonEnd = new Date('2026-10-03');

  // Check if dates are within valid season
  if (checkin < seasonStart || checkout > standardSeasonEnd) {
    errorsDiv.textContent = currentLang === 'fr'
      ? 'Fermé avant le 17 avril et après le 3 octobre 2026.'
      : 'Closed before April 17 and after October 3, 2026.';
    resultDiv.style.display = 'block';
    nightsSpan.textContent = nights;
    guestsSpan.textContent = `${adults} adulte(s), ${children} enfant(s)`;
    rateSpan.textContent = '-';
    taxSpan.textContent = '-';
    totalSpan.textContent = '-';
    sendEmailBtn.style.display = 'none';
    return;
  }

  // Check if stay is entirely in high season
  const isHighSeason = checkin >= highSeasonStart && checkout <= highSeasonEnd;
  const isMixedSeason = checkin < highSeasonStart && checkout > highSeasonStart;

  let price = 0;
  let rateDescription = '';

  if (isHighSeason) {
    // Fully in high season: €3900/week, Saturday to Saturday only, multiple weeks allowed
    const checkinDay = checkin.getDay();
    const checkoutDay = checkout.getDay();

    if (checkinDay !== 6 || checkoutDay !== 6) {
      errors.push(currentLang === 'fr'
        ? 'En haute saison, les arrivées et départs doivent être le samedi.'
        : 'During high season, check-in and check-out must be on Saturday.');
    }

    if (nights % 7 !== 0) {
      errors.push(currentLang === 'fr'
        ? 'En haute saison, les séjours doivent être par semaine complète (7, 14, 21 nuits...).'
        : 'During high season, stays must be full weeks (7, 14, 21 nights...).');
    }

    const weeks = Math.floor(nights / 7);
    price = weeks * 3900;
    rateDescription = currentLang === 'fr'
      ? (weeks === 1 ? '3 900€ / semaine' : `${weeks} semaines × 3 900€ = ${price.toLocaleString('fr-FR')}€`)
      : (weeks === 1 ? '€3,900 / week' : `${weeks} weeks × €3,900 = €${price.toLocaleString('fr-FR')}`);

  } else if (isMixedSeason) {
    // Mixed season: starts in standard, extends into high season
    const checkoutDay = checkout.getDay();

    // Check if checkout is in July/August (high season period)
    const isCheckoutInHighSeason = checkout >= highSeasonStart && checkout <= highSeasonEnd;

    if (isCheckoutInHighSeason && checkoutDay !== 6) {
      errors.push(currentLang === 'fr'
        ? 'Départ en juillet/août uniquement possible le samedi.'
        : 'Check-out in July/August only allowed on Saturday.');
    }

    // Calculate split pricing
    // Standard season nights: from checkin to July 4
    const standardNights = Math.round((highSeasonStart - checkin) / (1000 * 60 * 60 * 24));

    // High season nights: from July 4 to checkout
    const highSeasonNights = Math.round((checkout - highSeasonStart) / (1000 * 60 * 60 * 24));

    // Calculate standard season portion
    let standardPrice = 0;
    if (standardNights >= 15) {
      standardPrice = 5000 + ((standardNights - 15) * 333);
    } else if (standardNights === 7) {
      standardPrice = 2900;
    } else if (standardNights === 6) {
      standardPrice = 2700;
    } else if (standardNights === 5) {
      standardPrice = 2400;
    } else {
      standardPrice = standardNights * 500;
    }

    // Calculate high season portion (7-day blocks at 3900€/week)
    const highSeasonWeeks = Math.floor(highSeasonNights / 7);
    const highSeasonPrice = highSeasonWeeks * 3900;

    // Remaining nights in high season (less than a week) - not allowed if checkout is in high season
    const remainingHighSeasonNights = highSeasonNights % 7;
    if (remainingHighSeasonNights > 0 && isCheckoutInHighSeason) {
      errors.push(currentLang === 'fr'
        ? 'En juillet/août, les séjours doivent être par semaine complète (7 jours).'
        : 'In July/August, stays must be full weeks (7 days).');
    }

    price = standardPrice + highSeasonPrice;
    rateDescription = currentLang === 'fr'
      ? `Standard: ${standardPrice.toLocaleString('fr-FR')}€ + Haute saison: ${highSeasonPrice.toLocaleString('fr-FR')}€`
      : `Standard: €${standardPrice.toLocaleString('fr-FR')} + High season: €${highSeasonPrice.toLocaleString('fr-FR')}`;

  } else {
    // Fully in standard season pricing
    if (nights < 4) {
      errors.push(currentLang === 'fr'
        ? 'Minimum 4 nuits en période normale.'
        : 'Minimum 4 nights during standard period.');
    }

    // Degressive pricing
    if (nights >= 15) {
      // 15 nuits = 5000€, puis 333€ par nuit supplémentaire
      price = 5000 + ((nights - 15) * 333);
      rateDescription = currentLang === 'fr'
        ? `5 000€ + ${nights - 15} × 333€ = ${price.toLocaleString('fr-FR')}€`
        : `€5,000 + ${nights - 15} × €333 = €${price.toLocaleString('fr-FR')}`;
    } else if (nights === 7) {
      price = 2900;
      rateDescription = currentLang === 'fr' ? '2 900€ (7 nuits)' : '€2,900 (7 nights)';
    } else if (nights === 6) {
      price = 2700;
      rateDescription = currentLang === 'fr' ? '2 700€ (6 nuits)' : '€2,700 (6 nights)';
    } else if (nights === 5) {
      price = 2400;
      rateDescription = currentLang === 'fr' ? '2 400€ (5 nuits)' : '€2,400 (5 nights)';
    } else {
      price = nights * 500;
      rateDescription = currentLang === 'fr' ? `500€ × ${nights} nuits` : `€500 × ${nights} nights`;
    }
  }

  // Calculate tourist tax (Terre de Provence - meublé non classé)
  // 0.90€ per adult per night (18 years and over)
  const taxPerAdultPerNight = 0.90;
  const touristTax = adults * nights * taxPerAdultPerNight;
  const totalPrice = price + touristTax;

  // Store calculated data for email
  calculatedData = {
    checkin: checkinInput.value,
    checkout: checkoutInput.value,
    nights,
    adults,
    children,
    price,
    touristTax,
    totalPrice
  };

  // Display results
  nightsSpan.textContent = nights;
  guestsSpan.textContent = currentLang === 'fr'
    ? `${adults} adulte(s), ${children} enfant(s)`
    : `${adults} adult(s), ${children} child(ren)`;
  rateSpan.textContent = `${price.toLocaleString('fr-FR')}€`;
  taxSpan.textContent = `${touristTax.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}€`;
  totalSpan.textContent = `${totalPrice.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}€`;

  if (errors.length > 0) {
    errorsDiv.innerHTML = errors.join('<br>');
    sendEmailBtn.style.display = 'none';
  } else {
    errorsDiv.textContent = '';
    sendEmailBtn.style.display = 'block';
  }

  resultDiv.style.display = 'block';
}

// Send email button handler
if (sendEmailBtn) {
  sendEmailBtn.addEventListener('click', () => {
    if (!calculatedData) return;

    const subject = encodeURIComponent(
      currentLang === 'fr'
        ? "Demande de réservation - Mas Airaga"
        : "Booking request - Mas Airaga"
    );

    const body = encodeURIComponent(
      currentLang === 'fr'
        ? `Bonjour,\n\nJe souhaite réserver le Mas Airaga avec les informations suivantes :\n\nArrivée : ${calculatedData.checkin}\nDépart : ${calculatedData.checkout}\nNombre de nuits : ${calculatedData.nights}\n\nVoyageurs :\n- Adultes : ${calculatedData.adults}\n- Enfants : ${calculatedData.children}\n\nRécapitulatif des prix :\n- Tarif hébergement : ${calculatedData.price.toLocaleString('fr-FR')}€\n- Taxe de séjour : ${calculatedData.touristTax.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}€\n- Total TTC : ${calculatedData.totalPrice.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}€\n\nCordialement`
        : `Hello,\n\nI would like to book Mas Airaga with the following information:\n\nCheck-in: ${calculatedData.checkin}\nCheck-out: ${calculatedData.checkout}\nNumber of nights: ${calculatedData.nights}\n\nGuests:\n- Adults: ${calculatedData.adults}\n- Children: ${calculatedData.children}\n\nPrice summary:\n- Accommodation rate: €${calculatedData.price.toLocaleString('fr-FR')}\n- Tourist tax: €${calculatedData.touristTax.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n- Total incl. tax: €${calculatedData.totalPrice.toLocaleString('fr-FR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}\n\nBest regards`
    );

    window.location.href = `mailto:mas.airaga.contact@gmail.com?subject=${subject}&body=${body}`;
  });
}

if (checkinInput && checkoutInput && adultsInput && childrenInput) {
  checkinInput.addEventListener('change', calculatePrice);
  checkoutInput.addEventListener('change', calculatePrice);
  adultsInput.addEventListener('change', calculatePrice);
  childrenInput.addEventListener('change', calculatePrice);
}

// Fix for iOS Safari image loading issues
const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
if (isIOS) {
  // Remove lazy loading on iOS devices as it can cause rendering issues
  document.querySelectorAll('img[loading="lazy"]').forEach(img => {
    img.removeAttribute('loading');
    // Force image rendering
    img.style.opacity = '0';
    img.onload = function() {
      this.style.transition = 'opacity 0.3s ease';
      this.style.opacity = '1';
    };
    // Trigger load if already cached
    if (img.complete) {
      img.style.opacity = '1';
    }
  });
}

// Mobile hamburger menu
const hamburger = document.getElementById('nav-hamburger');
const navLinks = document.getElementById('nav-links');

if (hamburger && navLinks) {
  hamburger.addEventListener('click', () => {
    hamburger.classList.toggle('active');
    navLinks.classList.toggle('active');
    document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
  });

  // Close menu when clicking on a link
  navLinks.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      hamburger.classList.remove('active');
      navLinks.classList.remove('active');
      document.body.style.overflow = '';
    });
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!hamburger.contains(e.target) && !navLinks.contains(e.target)) {
      hamburger.classList.remove('active');
      navLinks.classList.remove('active');
      document.body.style.overflow = '';
    }
  });
}

// Smooth scroll for anchor links
document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
  anchor.addEventListener("click", function (e) {
    const targetId = this.getAttribute("href");
    const target = document.querySelector(targetId);
    if (target) {
      e.preventDefault();
      target.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  });
});

// Scroll to top button
const scrollToTopBtn = document.getElementById('scroll-to-top');

if (scrollToTopBtn) {
  window.addEventListener('scroll', () => {
    if (window.pageYOffset > 300) {
      scrollToTopBtn.classList.add('visible');
    } else {
      scrollToTopBtn.classList.remove('visible');
    }
  });

  scrollToTopBtn.addEventListener('click', () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });
}

// Lightbox functionality
const lightbox = document.getElementById('lightbox');
const lightboxImage = document.getElementById('lightbox-image');
const lightboxCaption = document.getElementById('lightbox-caption');
const galleryItems = document.querySelectorAll('.gallery-item');
const closeBtn = lightbox ? lightbox.querySelector('.lightbox__close') : null;
const prevBtn = lightbox ? lightbox.querySelector('.lightbox__prev') : null;
const nextBtn = lightbox ? lightbox.querySelector('.lightbox__next') : null;

let currentImageIndex = 0;
let currentGalleryImages = [];

if (lightbox && galleryItems.length > 0) {
  // Add click listeners to all gallery items
  galleryItems.forEach((item, index) => {
    item.addEventListener('click', () => {
      openLightbox(index);
    });
  });

  // Close button
  closeBtn.addEventListener('click', closeLightbox);

  // Previous/Next buttons
  prevBtn.addEventListener('click', showPrevImage);
  nextBtn.addEventListener('click', showNextImage);

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (lightbox.style.display === 'flex') {
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowLeft') showPrevImage();
      if (e.key === 'ArrowRight') showNextImage();
    }
  });

  // Close on background click
  lightbox.addEventListener('click', (e) => {
    if (e.target === lightbox) {
      closeLightbox();
    }
  });
}

function openLightbox(index) {
  // Convert NodeList to Array for easier manipulation
  currentGalleryImages = Array.from(galleryItems);
  currentImageIndex = index;

  const img = currentGalleryImages[currentImageIndex];
  lightboxImage.src = img.src;
  lightboxImage.alt = img.alt;

  // Set caption from data-category and alt
  const category = img.getAttribute('data-category') || '';
  const alt = img.alt || '';
  lightboxCaption.textContent = category ? `${category}` : alt;

  lightbox.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeLightbox() {
  lightbox.style.display = 'none';
  document.body.style.overflow = '';
}

function showPrevImage() {
  currentImageIndex = (currentImageIndex - 1 + currentGalleryImages.length) % currentGalleryImages.length;
  updateLightboxImage();
}

function showNextImage() {
  currentImageIndex = (currentImageIndex + 1) % currentGalleryImages.length;
  updateLightboxImage();
}

function updateLightboxImage() {
  const img = currentGalleryImages[currentImageIndex];
  lightboxImage.src = img.src;
  lightboxImage.alt = img.alt;

  const category = img.getAttribute('data-category') || '';
  const alt = img.alt || '';
  lightboxCaption.textContent = category ? `${category}` : alt;
}
